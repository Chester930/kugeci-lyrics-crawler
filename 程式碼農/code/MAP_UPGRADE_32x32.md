# 🗺️ 地图升级指南：22×22 → 32×32

## 📊 升级概览

### 旧布局（22×22）
```
总面积：484 格
- 左下角 16×16：仙人掌区（256 格）
- 三个角落 6×6：南瓜区（108 格）
- 其余区域：向日葵区（120 格）
```

### 新布局（32×32）✨
```
总面积：1024 格 (+540 格，+111.6%)
- 左下角 20×20：仙人掌区（400 格，+144 格，+56.3%）
- 三个角落 12×12：南瓜区（432 格，+324 格，+300%）
- 其余区域：向日葵区（192 格，+72 格，+60%）
```

---

## 🎯 区域定义变化

### 仙人掌区
```python
# 旧：16×16 (0-15, 0-15)
def is_cactus_zone(x, y):
    return x < 16 and y < 16

# 新：20×20 (0-19, 0-19)
def is_cactus_zone(x, y):
    return x < 20 and y < 20
```

**变化：**
- 面积：256 → 400 格 (+56.3%)
- 连锁收获：256² = 65,536 → 400² = 160,000 仙人掌 (+144%)
- 排序范围：0-15 → 0-19

---

### 南瓜区
```python
# 旧：三个 6×6 角落
def is_pumpkin_zone(x, y):
    # 右下角 (16-21, 0-5)
    if x >= 16 and y < 6:
        return True
    # 左上角 (0-5, 16-21)
    if x < 6 and y >= 16:
        return True
    # 右上角 (16-21, 16-21)
    if x >= 16 and y >= 16:
        return True
    return False

# 新：三个 12×12 角落
def is_pumpkin_zone(x, y):
    # 右下角 (20-31, 0-11)
    if x >= 20 and y < 12:
        return True
    # 左上角 (0-11, 20-31)
    if x < 12 and y >= 20:
        return True
    # 右上角 (20-31, 20-31)
    if x >= 20 and y >= 20:
        return True
    return False
```

**变化：**
- 单个区域：6×6 = 36 格 → 12×12 = 144 格 (+300%)
- 总面积：108 格 → 432 格 (+300%)
- 最大巨型南瓜：36 格 → 144 格
- 最大收获：36² = 1,296 → 144² = 20,736 南瓜 (+1,500%)

---

### 向日葵区
```python
# 新：其他所有区域
def is_sunflower_zone(x, y):
    return not is_cactus_zone(x, y) and not is_pumpkin_zone(x, y)
```

**变化：**
- 面积：120 格 → 192 格 (+60%)
- 能量产出提升 60%

---

## 🔧 关键参数调整

### 农场大小
```python
# 旧
farm_size = 22

# 新
farm_size = 32
```

### 仙人掌排序范围
```python
# 旧：横向排序
for x in range(0, 16):  # 0-15
    for y in range(0, 16):  # 0-15
        if y < 15:  # 不在最上边
            # 检查北方

# 新：横向排序
for x in range(0, 20):  # 0-19
    for y in range(0, 20):  # 0-19
        if y < 19:  # 不在最上边
            # 检查北方
```

```python
# 旧：纵向排序
for y in range(0, 16):  # 0-15
    for x in range(0, 16):  # 0-15
        if x < 15:  # 不在最右边
            # 检查东方

# 新：纵向排序
for y in range(0, 20):  # 0-19
    for x in range(0, 20):  # 0-19
        if x < 19:  # 不在最右边
            # 检查东方
```

### 仙人掌采收位置
```python
# 旧：移动到 (15, 15)
while get_pos_x() < 15:
    move(East)
while get_pos_y() < 15:
    move(North)

# 新：移动到 (19, 19)
while get_pos_x() < 19:
    move(East)
while get_pos_y() < 19:
    move(North)
```

---

## 📈 产量提升预测

### 仙人掌
```
旧：256² = 65,536 仙人掌/次
新：400² = 160,000 仙人掌/次
提升：+94,464 仙人掌 (+144%)
```

### 南瓜（理想情况）
```
旧：最大 36² = 1,296 南瓜/次
新：最大 144² = 20,736 南瓜/次
提升：+19,440 南瓜 (+1,500%)
```

### 向日葵
```
旧：120 格
新：192 格
提升：+72 格 (+60%)
```

### 总体
```
旧：484 格
新：1,024 格
提升：+540 格 (+111.6%)
```

---

## ⚠️ 注意事项

### 1. 性能影响
```
- 遍历时间：22² = 484 步 → 32² = 1,024 步 (+111.6%)
- 排序时间：256 格 → 400 格 (+56.3%)
- 每轮时间预计增加 ~100%
```

**建议：**
- 保持 `cactus_sorting_cycles = 4`（已优化）
- 保持 `do_a_flip()` 等待时间为 2（已优化）
- 保持积极采收模式（已实现）

### 2. 资源需求
```
水资源：
- 旧：484 格 × 0.95 = 459.8 水/轮
- 新：1,024 格 × 0.95 = 972.8 水/轮
- 增加：+513 水/轮 (+111.6%)

建议：确保 Unlocks.Watering 已升级到足够等级
```

```
南瓜种植成本：
- 旧：108 格 = 108 胡萝卜
- 新：432 格 = 432 胡萝卜
- 增加：+324 胡萝卜

建议：确保有足够的胡萝卜库存
```

### 3. 南瓜 ID 追踪
```
南瓜区域扩大 4 倍，ID 追踪系统需要更多时间
建议：保持 pumpkin_threshold = 6（已优化）
```

---

## 🚀 优化建议

### 1. 短期优化（立即实施）
```
✅ 已完成：
- farm_size = 32
- 仙人掌区 20×20
- 南瓜区 12×12
- 所有排序范围已更新
- 采收位置已更新
```

### 2. 中期优化（可选）
```
如果性能不足：
1. 调整 cactus_sorting_cycles（4 → 3）
2. 提高 pumpkin_threshold（6 → 8）
3. 降低水分阈值（0.95 → 0.90）
```

### 3. 长期优化（高级）
```
如果追求极限产量：
1. 实施肥料系统（向日葵区）
2. 实施伴生种植（向日葵区部分区域）
3. 考虑恐龙帽系统（需要更多空间）
```

---

## 📝 测试清单

### 启动前检查
- [ ] 确认地图已扩展到 32×32
- [ ] 确认水资源充足（建议 >1000）
- [ ] 确认胡萝卜充足（建议 >500）
- [ ] 清空旧布局的植物（可选）

### 运行中监控
- [ ] 仙人掌区是否正确种植（20×20）
- [ ] 南瓜区是否正确种植（三个 12×12）
- [ ] 向日葵区是否正确种植（其余区域）
- [ ] 仙人掌排序是否正常（右上角最大）
- [ ] 仙人掌采收是否触发（位置 19,19）

### 性能评估
- [ ] 每轮时间是否可接受
- [ ] 采收频率是否正常
- [ ] 资源消耗是否在预期范围

---

## 🎉 预期收益

### 保守估计（实际可达）
```
仙人掌：160,000/次（排序完成时）
南瓜：平均 ~5,000/次（部分巨型南瓜）
向日葵：192 格持续产出
能量：5x 能量（高花瓣向日葵）

总体产量提升：+100-150%
```

### 理想情况（完美运行）
```
仙人掌：160,000/次
南瓜：20,736/次（完美巨型南瓜）
向日葵：192 格 × 5x 能量
能量加速：2x 无人机速度

总体产量提升：+200-300%
```

---

## 🔄 回滚方案

如果新布局出现问题，可以快速回滚到 22×22：

```python
# 回滚到 22×22
farm_size = 22

def is_cactus_zone(x, y):
    return x < 16 and y < 16

def is_pumpkin_zone(x, y):
    if x >= 16 and y < 6:
        return True
    if x < 6 and y >= 16:
        return True
    if x >= 16 and y >= 16:
        return True
    return False

# 排序范围改回 0-15
# 采收位置改回 (15, 15)
```

---

**升级完成！祝您的 32×32 农场大丰收！** 🌾✨

