# 🗺️ 最终农场布局指南

## 📐 22×22 农场布局

```
     0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21
   ┌──────────────────────────────────────────────────────────────────┐
21 │🎃🎃🎃🎃🎃🎃🌻🌻🌻🌻🌻🌻🌻🌻🌻🌻🎃🎃🎃🎃🎃🎃│ 21
20 │🎃🎃🎃🎃🎃🎃🌻🌻🌻🌻🌻🌻🌻🌻🌻🌻🎃🎃🎃🎃🎃🎃│ 20
19 │🎃🎃🎃🎃🎃🎃🌻🌻🌻🌻🌻🌻🌻🌻🌻🌻🎃🎃🎃🎃🎃🎃│ 19
18 │🎃🎃🎃🎃🎃🎃🌻🌻🌻🌻🌻🌻🌻🌻🌻🌻🎃🎃🎃🎃🎃🎃│ 18
17 │🎃🎃🎃🎃🎃🎃🌻🌻🌻🌻🌻🌻🌻🌻🌻🌻🎃🎃🎃🎃🎃🎃│ 17
16 │🎃🎃🎃🎃🎃🎃🌻🌻🌻🌻🌻🌻🌻🌻🌻🌻🎃🎃🎃🎃🎃🎃│ 16
15 │🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌻🌻🌻🌻🌻🌻│ 15
14 │🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌻🌻🌻🌻🌻🌻│ 14
13 │🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌻🌻🌻🌻🌻🌻│ 13
12 │🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌻🌻🌻🌻🌻🌻│ 12
11 │🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌻🌻🌻🌻🌻🌻│ 11
10 │🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌻🌻🌻🌻🌻🌻│ 10
 9 │🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌻🌻🌻🌻🌻🌻│  9
 8 │🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌻🌻🌻🌻🌻🌻│  8
 7 │🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌻🌻🌻🌻🌻🌻│  7
 6 │🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌵🌻🌻🌻🌻🌻🌻│  6
 5 │🌵🌵🌵🌵🌵🌵🌻🌻🌻🌻🌻🌻🌻🌻🌻🌻🎃🎃🎃🎃🎃🎃│  5
 4 │🌵🌵🌵🌵🌵🌵🌻🌻🌻🌻🌻🌻🌻🌻🌻🌻🎃🎃🎃🎃🎃🎃│  4
 3 │🌵🌵🌵🌵🌵🌵🌻🌻🌻🌻🌻🌻🌻🌻🌻🌻🎃🎃🎃🎃🎃🎃│  3
 2 │🌵🌵🌵🌵🌵🌵🌻🌻🌻🌻🌻🌻🌻🌻🌻🌻🎃🎃🎃🎃🎃🎃│  2
 1 │🌵🌵🌵🌵🌵🌵🌻🌻🌻🌻🌻🌻🌻🌻🌻🌻🎃🎃🎃🎃🎃🎃│  1
 0 │🌵🌵🌵🌵🌵🌵🌻🌻🌻🌻🌻🌻🌻🌻🌻🌻🎃🎃🎃🎃🎃🎃│  0
   └──────────────────────────────────────────────────────────────────┘
     0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21

图例：
🌵 = 仙人掌区 (Cactus Zone)
🎃 = 南瓜区 (Pumpkin Zone)
🌻 = 向日葵区 (Sunflower Zone)
```

---

## 🎯 区域定义

### 1️⃣ 仙人掌区 (16×16 = 256格)
```python
def is_cactus_zone(x, y):
    return x < 16 and y < 16

座标范围：
- X: 0-15
- Y: 0-15
- 位置：左下角
- 面积：256格
```

**特性：**
- ✅ 自动排序（右上角最大，左下角最小）
- ✅ 连锁采收：256² = **65,536 仙人掌/次**
- ✅ 高水分需求（< 0.75）
- ✅ 每轮7次排序循环
- ✅ 排序完成自动采收

---

### 2️⃣ 南瓜区 (3个6×6 = 108格)

#### 右下角南瓜区
```python
x >= 16 and y < 6

座标范围：
- X: 16-21
- Y: 0-5
- 面积：36格
```

#### 左上角南瓜区
```python
x < 6 and y >= 16

座标范围：
- X: 0-5
- Y: 16-21
- 面积：36格
```

#### 右上角南瓜区
```python
x >= 16 and y >= 16

座标范围：
- X: 16-21
- Y: 16-21
- 面积：36格
```

**特性：**
- ✅ ID追踪系统（连续出现9次才采收）
- ✅ 自动合并成巨型南瓜
- ✅ 高水分需求（< 0.75）
- ✅ 自动清理死南瓜
- ✅ 分别追踪纵向和横向移动

---

### 3️⃣ 向日葵区 (剩余区域 = 120格)

```python
def is_sunflower_zone(x, y):
    return not is_cactus_zone(x, y) and not is_pumpkin_zone(x, y)

包含区域：
- 右侧条带：(16-21, 6-15) = 60格
- 上方条带：(6-15, 16-21) = 60格
- 总计：120格
```

**特性：**
- ✅ 简单直接采收
- ✅ 中等水分需求（< 0.5）
- ✅ 自动清理死南瓜
- ✅ 持续产出资源

---

## 📊 面积分配统计

| 区域 | 面积 | 占比 | 主要产出 |
|------|------|------|----------|
| 🌵 仙人掌区 | 256格 | 53.3% | 65,536/次 |
| 🎃 南瓜区 | 108格 | 22.5% | 巨型南瓜 |
| 🌻 向日葵区 | 120格 | 25.0% | 持续产出 |
| **总计** | **484格** | **100%** | - |

---

## 🔧 核心功能

### 仙人掌管理
```python
# 排序参数
cactus_sorting_cycles = 7  # 每轮7次排序

# 排序逻辑
- 横向移动：检查北方，大的向北推
- 纵向移动：检查东方，大的向东推
- 目标：右上角(15,15)最大，左下角(0,0)最小

# 采收触发
- 条件：total_swap_count == 0（排序完成）
- 位置：移动到(15, 15)
- 收益：256² = 65,536 仙人掌
```

### 南瓜管理
```python
# ID追踪系统
pumpkin_threshold = 9  # 连续出现9次

# 追踪变量
- last_pumpkin_id_vertical（纵向）
- last_pumpkin_id_horizontal（横向）
- consecutive_count_vertical
- consecutive_count_horizontal

# 采收逻辑
1. 检测 measure() 返回的 ID
2. 如果 ID 相同，计数 +1
3. 如果 ID 不同，重置计数
4. 达到阈值 9 次，采收并重置
```

### 向日葵管理
```python
# 简单逻辑
1. 清理死南瓜
2. 除草翻土
3. 成熟即采收
4. 自动补种
```

---

## 🚀 运行流程

### 主循环
```python
while True:
    1. round_count += 1
    2. smart_zone_harvest()      # S型采收（纵横交替）
    3. 仙人掌排序（7次循环）
    4. 检查排序完成 → 采收仙人掌
    5. 如果无收获 → 等待生长
```

### S型移动策略
```python
# 偶数轮：纵向S型
for x in range(22):
    for y in range(22):
        处理当前格子
        if x % 2 == 0: move(North)
        else: move(South)

# 奇数轮：横向S型
for y in range(22):
    for x in range(22):
        处理当前格子
        if y % 2 == 0: move(East)
        else: move(West)
```

---

## 💡 优化建议

### 仙人掌优化
- ✅ 已实现：7次排序循环
- ✅ 已实现：提前退出（无交换时）
- ✅ 已实现：自动采收触发

### 南瓜优化
- ✅ 已实现：ID追踪防止误采
- ✅ 已实现：分离纵横追踪
- ⚠️ 可调整：pumpkin_threshold（当前9次）

### 向日葵优化
- ✅ 已实现：简单高效
- ✅ 已实现：自动清理

---

## ⚙️ 配置参数

```python
# 农场大小
farm_size = 22

# 仙人掌排序
cactus_sorting_cycles = 7  # 推荐：5-10

# 南瓜追踪
pumpkin_threshold = 9  # 推荐：6-12

# 恐龙模式（可选）
enable_dinosaur_mode = False  # 默认关闭
dinosaur_mode_trigger_cactus = 10000
dinosaur_target_tail_length = 200
```

---

## 📈 预期收益

### 仙人掌收益
- **单次采收：65,536 仙人掌**
- 排序时间：约 7-15 轮
- 成长时间：视水分而定

### 南瓜收益
- 3个6×6区域 = 108格
- 巨型南瓜合并
- ID追踪确保最佳采收时机

### 向日葵收益
- 120格持续产出
- 快速成长
- 稳定资源来源

---

## 🎮 使用说明

1. **启动程序**
   - 直接运行 `main.py`
   - 无人机自动开始工作

2. **观察仙人掌**
   - 初期：种植填满
   - 中期：排序中（颜色变化）
   - 完成：全部变绿 → 自动采收

3. **观察南瓜**
   - 需要连续9次相同ID才采收
   - 确保采收的是巨型南瓜

4. **观察向日葵**
   - 持续采收
   - 无需特殊管理

---

**最终布局已完成！仙人掌产量 65,536/次，南瓜3区域，向日葵持续产出！** 🌵🎃🌻✨

