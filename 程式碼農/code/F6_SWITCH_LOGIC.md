# 🔄 F6 模式切换逻辑详解

## 📋 核心切换规则

### ✅ 您的理解完全正确！

> **"迷宫模式切换成生产模式，是当诡异作物不足以开启新迷宫时切换"**

---

## 🔍 详细切换机制

### 1️⃣ 生产模式 → 迷宫模式

**触发条件：**
```python
if num_items(Items.Weird_Substance) >= 50000:
    current_mode = "MAZE"
```

**说明：**
- 当积累到 50,000 Weird_Substance 时
- 立即切换到迷宫模式
- 开始消耗 Weird_Substance 获取金币

---

### 2️⃣ 迷宫模式 → 生产模式

**触发条件（两个检查点）：**

#### 检查点 A：保底阈值
```python
if num_items(Items.Weird_Substance) < 100:
    current_mode = "FARM"
```

#### 检查点 B：创建迷宫时（主要检查点）
```python
maze_level = num_unlocked(Unlocks.Mazes)
substance_needed = farm_size * 2**(maze_level - 1)

if num_items(Items.Weird_Substance) < substance_needed:
    current_mode = "FARM"  # 无法创建新迷宫！
```

**说明：**
- **检查点 B 是主要切换点**
- 当 Weird_Substance **不足以创建新迷宫**时
- 立即切换回生产模式
- 不会浪费任何 Weird_Substance

---

## 📊 实际运行示例

### 场景：32×32 地图，迷宫等级 0

```
初始状态：
→ Weird_Substance：85,000
→ 每个迷宫需要：32
→ 模式：MAZE

迷宫 1：
→ 检查：85,000 >= 32？✅ 是
→ 创建迷宫（-32）
→ 走迷宫 → 获得金币
→ 剩余：84,968

迷宫 2：
→ 检查：84,968 >= 32？✅ 是
→ 创建迷宫（-32）
→ 走迷宫 → 获得金币
→ 剩余：84,936

...（持续循环）...

迷宫 2,656：
→ 检查：48 >= 32？✅ 是
→ 创建迷宫（-32）
→ 走迷宫 → 获得金币
→ 剩余：16

迷宫 2,657（尝试）：
→ 检查：16 >= 32？❌ 否
→ 无法创建新迷宫！
→ 切换到生产模式（FARM）
→ 剩余：16（保留）
```

---

## 💡 为什么这样设计？

### ✅ 优点

1. **最大化资源利用**
   - 用尽所有可用的 Weird_Substance
   - 不会浪费任何资源
   - 最大化金币产出

2. **自动化**
   - 无需手动干预
   - 自动检测资源不足
   - 自动切换模式

3. **智能判断**
   - 不是简单的固定阈值（如 < 100）
   - 而是根据**实际需求**判断
   - 适应不同的迷宫等级

---

## 🎯 不同迷宫等级的切换点

| 迷宫等级 | 每个迷宫需要 | 切换点 |
|---------|------------|-------|
| 0 | 32 | < 32 |
| 1 | 64 | < 64 |
| 2 | 128 | < 128 |
| 3 | 256 | < 256 |
| 4 | 512 | < 512 |

**说明：**
- 迷宫等级越高，需要的 Weird_Substance 越多
- 切换点会**自动调整**
- 确保不会浪费资源

---

## 🔄 完整循环流程

```
1. 生产模式（FARM）
   ↓
   积累 Weird_Substance（0 → 50,000）
   ↓
2. 检查：>= 50,000？
   ↓ 是
3. 切换到迷宫模式（MAZE）
   ↓
4. 循环：
   - 检查：Weird >= 需求？
   - 是 → 创建迷宫 → 走迷宫 → 获得金币
   - 否 → 跳到步骤 5
   ↓
5. 无法创建新迷宫
   ↓
6. 切换回生产模式（FARM）
   ↓
7. 回到步骤 1（循环）
```

---

## 📈 效率分析

### 单次循环（50,000 Weird_Substance）

```
生产阶段：
→ 时间：~20 分钟
→ 产出：50,000 Weird_Substance

迷宫阶段：
→ 迷宫数量：50,000 ÷ 32 = 1,562 个
→ 金币产出：1,562 × 1,024 = 1,599,488
→ 剩余：50,000 - (1,562 × 32) = 16
→ 时间：~40-60 分钟

总计：
→ 时间：~60-80 分钟/循环
→ 金币：~1,599,488/循环
→ 效率：~24,000 金币/分钟
```

---

## ✅ 总结

### 核心切换逻辑

1. **进入迷宫模式**：Weird_Substance >= 50,000
2. **退出迷宫模式**：Weird_Substance < 创建迷宫所需数量
3. **保底检查**：Weird_Substance < 100（额外保护）

### 关键特点

- ✅ **智能判断**：根据实际需求切换
- ✅ **资源最大化**：用尽所有可用资源
- ✅ **自动适应**：适应不同迷宫等级
- ✅ **完全自动化**：无需手动干预

---

**您的理解完全正确！迷宫模式会持续运行，直到无法创建新迷宫为止！** ✅🔄💰

