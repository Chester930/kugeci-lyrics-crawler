# 🚀 F4 极限产量策略指南

## 🎯 策略目标

**最大化单位时间的 Weird_Substance 产量**

结合两种策略的优势：
- 仙人掌：100%感染 + 排序 + 连锁收获（高单次产量）
- 南瓜：100%感染 + 直接采收（高频率）

---

## 📊 产量对比

### 三种策略对比

| 策略 | 仙人掌策略 | 南瓜策略 | 小时产量 | 复杂度 |
|------|-----------|---------|---------|--------|
| **f3.py** | 直接采收 | 直接采收 | ~20,000 | 低 |
| **main.py** | 排序+连锁（无感染） | ID追踪（无感染） | 0 | 高 |
| **f4.py** | 排序+连锁+100%感染 | 直接采收+100%感染 | **~100,000+** | 中 |

**f4.py 是最高产量策略！** 🏆

---

## 🔧 核心机制

### 仙人掌区（左下角 20×20）

#### 阶段 1：种植 + 感染
```python
1. 遍历仙人掌区
2. 种植仙人掌
3. 立即使用肥料感染（100%感染率）
4. 使用肥料加速生长
5. 极限浇水（0.95）
```

#### 阶段 2：等待成熟
```python
1. 持续遍历农场（处理南瓜和向日葵）
2. 检查仙人掌是否全部成熟
3. 未成熟的仙人掌继续使用肥料加速
```

#### 阶段 3：排序
```python
1. 当所有仙人掌成熟后
2. 执行排序（横向 + 纵向）
3. 目标：右上最大，左下最小
4. 排序完成后变绿色
```

#### 阶段 4：连锁收获
```python
1. 移动到右上角 (19, 19)
2. 触发连锁收获
3. 获得：
   - 仙人掌：400² × 50% = 80,000
   - Weird_Substance：400² × 50% = 80,000
```

**关键：100% 感染率确保最大 Weird_Substance 产出！**

---

### 南瓜区（三个角落 12×12）

#### 策略：直接采收（高频率）
```python
1. 种植南瓜
2. 立即使用肥料感染
3. 成熟后直接采收
4. 获得：0.5 南瓜 + 0.5 Weird_Substance
5. 重复
```

**为什么不排序南瓜？**
- 南瓜区域分散（三个角落）
- 排序复杂度高
- 直接采收更高效

---

### 向日葵区（其余区域）

#### 策略：能量生产
```python
1. 优先收获高花瓣向日葵（≥13）
2. 获得 5x 能量
3. 提供 2x 无人机速度
4. 加速整体采收
```

---

## 📈 产量分析

### 仙人掌区

#### 单次产量
```
400 个仙人掌（100% 感染）
连锁收获：400² = 160,000

分配：
- 仙人掌：160,000 × 50% = 80,000
- Weird_Substance：160,000 × 50% = 80,000
```

#### 时间分析
```
种植 + 感染：5 分钟
等待成熟：10 分钟
排序：10 分钟
连锁收获：1 分钟
总计：26 分钟/次

1 小时可执行：60 / 26 ≈ 2.3 次
```

#### 小时产量
```
80,000 × 2.3 = 184,000 Weird_Substance/小时
```

---

### 南瓜区

#### 单次产量
```
1 个南瓜（100% 感染）
直接采收：1

分配：
- 南瓜：1 × 50% = 0.5
- Weird_Substance：1 × 50% = 0.5
```

#### 时间分析
```
种植 + 感染：5 秒
生长：30 / 4.75 - 2 ≈ 4.3 秒
采收：2 秒
总计：11.3 秒/次

432 格并行生长
```

#### 小时产量
```
432 × 0.5 × (60 × 60 / 11.3) ≈ 68,850 Weird_Substance/小时
```

**注意：** 实际产量会因为遍历时间而降低，预计 ~15,000/小时

---

### 总产量

```
仙人掌：~184,000/小时
南瓜：~15,000/小时
总计：~199,000 Weird_Substance/小时
```

**保守估计：~100,000 Weird_Substance/小时**

---

## 🔑 关键参数

### 肥料管理
```python
fertilizer_min_stock = 20  # 提高到 20
```

**原因：**
- 仙人掌区需要大量肥料（400 个）
- 南瓜区持续需要肥料（432 个）
- 确保不会耗尽

**建议：**
- 升级 `Unlocks.Fertilizer` 到最高等级
- 监控肥料库存
- 如果 < 20，暂停使用

---

### 排序参数
```python
cactus_sorting_cycles = 4  # 排序循环次数
```

**说明：**
- 每轮执行 4 次排序循环
- 如果提前完成（无交换），提前结束
- 平衡速度和完整性

---

### 感染策略
```python
use_fertilizer_on_cactus = True   # 仙人掌 100% 感染
use_fertilizer_on_pumpkin = True  # 南瓜 100% 感染
```

**关键：**
- 种植后立即使用肥料
- 确保 100% 感染率
- 最大化 Weird_Substance 产出

---

## 🎯 执行流程

### 主循环

```
第 1-5 轮：
├─ 遍历农场
│  ├─ 南瓜区：采收 + 重新种植 + 感染
│  ├─ 向日葵区：采收高花瓣
│  └─ 仙人掌区：种植 + 感染 + 加速
├─ 检查仙人掌是否全部成熟
└─ 如果未成熟，继续下一轮

第 6 轮（仙人掌成熟）：
├─ 遍历农场（南瓜和向日葵）
├─ 检查仙人掌全部成熟 ✓
├─ 执行排序
│  ├─ 横向排序
│  ├─ 纵向排序
│  └─ 重复 4 次或提前结束
├─ 排序完成
├─ 移动到 (19, 19)
├─ 连锁收获
│  ├─ 获得 80,000 仙人掌
│  └─ 获得 80,000 Weird_Substance 🎉
└─ 重置，开始下一轮

第 7-11 轮：
└─ 重复第 1-6 轮
```

---

## ⚙️ 优化技巧

### 1. 加速仙人掌成熟
```python
# 在遍历时，对未成熟的仙人掌使用肥料
if status['entity'] == Entities.Cactus and not status['can_harvest']:
    if num_items(Items.Fertilizer) > fertilizer_min_stock:
        use_item(Items.Fertilizer)
```

**效果：**
- 缩短等待时间
- 更快进入排序阶段
- 提高整体效率

---

### 2. 极限浇水
```python
if status['water'] < 0.95:
    use_item(Items.Water)
```

**效果：**
- 生长速度 4.75x
- 接近最大速度（5x）
- 所有区域受益

---

### 3. 能量加速
```python
# 优先收获高花瓣向日葵
if petals >= 13:
    harvest()  # 获得 5x 能量
```

**效果：**
- 无人机速度 2x
- 遍历更快
- 整体效率提升

---

### 4. 并行处理
```python
# 在等待仙人掌成熟时
# 持续采收南瓜和向日葵
```

**效果：**
- 最大化时间利用
- 持续产出 Weird_Substance
- 不浪费任何时间

---

## 📊 与其他策略对比

### vs f3.py（直接采收）

| 项目 | f3.py | f4.py | 提升 |
|------|-------|-------|------|
| 仙人掌单次 | 0.5 | 80,000 | **+159,999** |
| 仙人掌频率 | 极高 | 低 | - |
| 仙人掌小时 | ~200 | ~184,000 | **+920x** |
| 南瓜小时 | ~15,000 | ~15,000 | 相同 |
| 总产量 | ~20,000 | ~100,000+ | **+5x** |
| 复杂度 | 低 | 中 | - |

**f4.py 产量是 f3.py 的 5 倍以上！** 🚀

---

### vs main.py（无感染）

| 项目 | main.py | f4.py | 差异 |
|------|---------|-------|------|
| 仙人掌 | 160,000 | 80,000 仙人掌 + 80,000 Weird | 转换 |
| 南瓜 | 20,736 | 216 南瓜 + 216 Weird | 转换 |
| Weird | 0 | ~100,000/小时 | **+100,000** |
| 目标 | 资源积累 | Weird_Substance | 不同 |

**f4.py 专注于 Weird_Substance，main.py 专注于资源。**

---

## ⚠️ 注意事项

### 1. 肥料消耗巨大
```
仙人掌区：400 个 × 多次加速 = ~1,000 肥料/次
南瓜区：432 个 × 持续 = ~500 肥料/小时
总计：~2,000 肥料/小时

建议：
✅ 升级 Unlocks.Fertilizer 到最高等级（8 个/10 秒）
✅ 监控肥料库存
✅ 设置 fertilizer_min_stock = 20
```

---

### 2. 等待时间较长
```
仙人掌从种植到采收：~26 分钟
其中排序：~10 分钟

优化：
✅ 在等待时持续采收南瓜和向日葵
✅ 使用肥料加速仙人掌成熟
✅ 极限浇水加速生长
```

---

### 3. 100% 感染率要求
```
必须确保所有仙人掌都被感染

方法：
✅ 种植后立即使用肥料
✅ 遍历时对未成熟的继续使用肥料
✅ 监控肥料库存 > 20
```

---

### 4. 资源平衡
```
水资源：~973/轮（与其他策略相同）
肥料：~2,000/小时（远高于其他策略）

建议：
✅ 优先升级肥料
✅ 如果肥料不足，暂时关闭南瓜区感染
✅ 保证仙人掌区 100% 感染（优先级最高）
```

---

## 🎉 总结

### 核心优势
```
✅ 最高单位时间产量（~100,000/小时）
✅ 结合两种策略优势
✅ 仙人掌 n² 收益（80,000 Weird_Substance/次）
✅ 南瓜持续产出（~15,000/小时）
✅ 100% 感染率确保最大产出
```

### 适用场景
```
✅ 需要大量 Weird_Substance
✅ 肥料资源充足
✅ 追求极限产量
✅ 愿意等待仙人掌成熟
```

### 不适用场景
```
❌ 肥料不足
❌ 需要快速产出（用 f3.py）
❌ 追求简单（用 f3.py）
❌ 需要仙人掌资源（用 main.py）
```

---

## 🚀 快速开始

### 前置条件
```
1. 地图大小：32×32
2. 肥料升级：最高等级（推荐）
3. 水资源：充足（>1000）
4. 肥料库存：>50（启动时）
```

### 启动步骤
```
1. 确认前置条件
2. 运行 f4.py
3. 观察仙人掌种植和感染
4. 等待第一次连锁收获（~26 分钟）
5. 检查 Weird_Substance 库存
6. 享受极限产量！
```

---

**F4 极限产量策略 - 单位时间最高 Weird_Substance 产出！** 🚀🧪✨

