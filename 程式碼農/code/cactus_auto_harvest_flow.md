# 仙人掌自動採收流程說明

## 🔄 **完整循環流程**

```
開始
  ↓
┌─────────────────────────────────────┐
│  第 N 輪                            │
├─────────────────────────────────────┤
│                                     │
│  1️⃣ 經過模式 (smart_zone_harvest)  │
│     ├─ 種植新仙人掌                │
│     ├─ 澆水                        │
│     ├─ 採收其他作物                │
│     └─ 跳過仙人掌（不採收）        │
│                                     │
│  2️⃣ 排序階段 (7次循環)             │
│     ├─ 橫向排序（檢查北方）        │
│     ├─ 縱向排序（檢查東方）        │
│     ├─ 交替執行                    │
│     └─ 記錄交換次數                │
│                                     │
│  3️⃣ 採收檢查                       │
│     ├─ 如果 total_swap_count == 0  │
│     │   └─ 排序完成！              │
│     │       ├─ 移動到 (15, 15)     │
│     │       ├─ 檢查仙人掌成熟      │
│     │       └─ 執行連鎖採收 ⭐     │
│     │           └─ 獲得 n² 收益    │
│     │                              │
│     └─ 如果 total_swap_count > 0   │
│         └─ 還在排序中，繼續...     │
│                                     │
│  4️⃣ 等待生長                       │
│     └─ 如果沒有其他收穫，翻滾      │
│                                     │
└─────────────────────────────────────┘
  ↓
回到第 N+1 輪
```

---

## 📊 **採收觸發條件**

### ✅ **觸發採收**
```python
if total_swap_count == 0:
    # 條件：上一輪排序階段沒有任何交換
    # 意義：所有仙人掌已經排序完成（變綠色）
    # 動作：執行連鎖採收
```

### ❌ **不採收**
```python
if total_swap_count > 0:
    # 條件：上一輪排序階段還有交換
    # 意義：仙人掌還在排序中（有棕色的）
    # 動作：繼續下一輪排序
```

---

## 🎯 **採收流程詳解**

### 步驟 1：判斷排序完成
```python
total_swap_count == 0  # 沒有交換 = 排序完成
```

### 步驟 2：移動到右上角
```python
while get_pos_x() < 15:
    move(East)
while get_pos_y() < 15:
    move(North)
# 到達 (15, 15) - 最大值位置
```

### 步驟 3：檢查仙人掌
```python
if get_entity_type() == Entities.Cactus and can_harvest():
    # 確認有成熟的仙人掌
```

### 步驟 4：執行連鎖採收
```python
cactus_before = num_items(Items.Cactus)
harvest()  # 觸發連鎖！
cactus_after = num_items(Items.Cactus)
gained = cactus_after - cactus_before
```

### 步驟 5：繼續循環
```python
reset_position()
# 下一輪會重新種植仙人掌
```

---

## 💎 **收益計算**

### 連鎖採收公式：
```
收益 = n² 個仙人掌
n = 連鎖採收的仙人掌數量
```

### 範例：
| 連鎖數 | 收益公式 | 實際獲得 |
|-------|---------|---------|
| 10x10 (100) | 100² | **10,000** |
| 8x8 (64) | 64² | **4,096** |
| 5x5 (25) | 25² | **625** |

---

## 🔄 **完整週期**

```
輪次 1-5：種植、生長
  └─ 排序階段有交換 (total_swap_count > 0)
  └─ 不採收，繼續排序

輪次 6-10：持續排序
  └─ 排序階段有交換 (total_swap_count > 0)
  └─ 不採收，繼續排序

輪次 11：排序完成
  └─ 排序階段無交換 (total_swap_count == 0) ⭐
  └─ 觸發自動採收
  └─ 獲得 10,000 個仙人掌！

輪次 12：重新開始
  └─ 種植新仙人掌
  └─ 開始新的排序週期
```

---

## ⚙️ **調整參數**

### 排序循環次數
```python
cactus_sorting_cycles = 7  # 當前設定
```
- 數值越大：排序越快完成
- 數值越小：每輪時間越短

### 南瓜採收閾值
```python
pumpkin_threshold = 9  # 當前設定
```
- 控制南瓜的採收標準

---

## 🎮 **使用方式**

### 啟動程式
```python
python strategy_zone_harvest.py
```

### 程式會自動：
1. ✅ 種植仙人掌
2. ✅ 持續排序（每輪7次）
3. ✅ 檢測排序完成
4. ✅ **自動採收連鎖** ⭐
5. ✅ 重新種植
6. ✅ 循環執行

---

## 📝 **監控指標**

### 排序進度
- `total_swap_count > 0`：還在排序
- `total_swap_count == 0`：排序完成，準備採收

### 採收時機
- 當輪次結束且 `total_swap_count == 0`
- 自動移動到 (15, 15) 執行連鎖

### 收益記錄
- `cactus_gained`：本次採收獲得數量
- 預期：**10,000 個仙人掌**（滿額）

---

## 🎉 **完成！**

現在程式會：
- 🌱 自動種植
- 🔄 自動排序
- ⏰ 自動檢測完成
- 🌵 **自動採收連鎖**
- 🔁 自動重新開始

**完全自動化的仙人掌農場！** 🚀

